---
phase: 05-ai-clinical-intelligence
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - apps/web/src/components/clinical/ai-treatment-suggestions.tsx
  - apps/web/src/app/(dashboard)/patients/[id]/page.tsx
autonomous: true
requirements: [AI-05]

must_haves:
  truths:
    - "Dentist can click a button on patient page to get AI treatment suggestions based on odontogram"
    - "AI suggestions show tooth number, description, NZa code, reasoning, and priority"
    - "Suggestions are clearly labeled as AI-generated and not auto-applied"
    - "Dentist can accept individual suggestions to create treatment plan items"
  artifacts:
    - path: "apps/web/src/components/clinical/ai-treatment-suggestions.tsx"
      provides: "AI treatment suggestion panel component"
      contains: "ai/suggest-treatment"
    - path: "apps/web/src/app/(dashboard)/patients/[id]/page.tsx"
      provides: "Patient page with AI treatment suggestion integration"
      contains: "AiTreatmentSuggestions"
  key_links:
    - from: "apps/web/src/components/clinical/ai-treatment-suggestions.tsx"
      to: "/api/ai/suggest-treatment"
      via: "fetch call"
      pattern: "fetch.*api/ai/suggest-treatment"
    - from: "apps/web/src/app/(dashboard)/patients/[id]/page.tsx"
      to: "apps/web/src/components/clinical/ai-treatment-suggestions.tsx"
      via: "component import"
      pattern: "AiTreatmentSuggestions"
---

<objective>
Build AI treatment suggestion UI that shows dentists AI-recommended treatments based on odontogram diagnoses.

Purpose: AI-05 requirement - AI suggests treatment plans from recorded diagnoses.
Output: New AI treatment suggestion component integrated into patient page.
</objective>

<execution_context>
@/Users/farazsharifi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/farazsharifi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ai-clinical-intelligence/05-01-SUMMARY.md
@apps/web/src/app/(dashboard)/patients/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AI treatment suggestion component</name>
  <files>apps/web/src/components/clinical/ai-treatment-suggestions.tsx</files>
  <action>
Create a new component `AiTreatmentSuggestions` that:

1. Props: `{ patientId: string, onAcceptTreatment?: (treatment: SuggestedTreatment) => void }`.

2. Has a "AI Behandeladvies" button (Sparkles icon). On click, calls `POST /api/ai/suggest-treatment` with `{ patientId }`.

3. Shows loading state during API call.

4. Displays results in a card/panel:
   - Header: treatment plan title from AI + "AI-suggestie" badge (clearly distinct styling).
   - List of suggested treatments, each showing:
     - Tooth number (element) with FDI notation
     - Description of treatment
     - NZa code + tariff
     - Priority badge (HIGH=red, MEDIUM=amber, LOW=green — use static Tailwind class maps, NOT dynamic interpolation)
     - AI reasoning in a smaller/muted text
     - "Overnemen" button per treatment to accept it
   - "Alles overnemen" button to accept all suggestions at once.
   - "Sluiten" button to dismiss.

5. When "Overnemen" is clicked for a treatment:
   - Call the existing `POST /api/treatment-plans` to create a plan (if not yet created), then `POST /api/treatment-plans/[id]/treatments` to add the treatment item.
   - Mark the accepted item visually (checkmark, greyed out).
   - Use authFetch from `@/lib/auth-fetch.ts` for these calls.

6. Empty state: if patient has no odontogram data, show "Geen diagnosegegevens gevonden. Vul eerst het odontogram in."

Style using existing shadcn/ui components (Button, Card) and Tailwind. Keep consistent with dashboard styling patterns.
  </action>
  <verify>`pnpm --filter @dentflow/web build` succeeds. Component renders without errors.</verify>
  <done>AI treatment suggestion component displays suggestions with accept/dismiss per item, creates treatment plan items on accept</done>
</task>

<task type="auto">
  <name>Task 2: Integrate AI treatment suggestions into patient page</name>
  <files>apps/web/src/app/(dashboard)/patients/[id]/page.tsx</files>
  <action>
Add the AiTreatmentSuggestions component to the patient detail page:

1. Import `AiTreatmentSuggestions` from `@/components/clinical/ai-treatment-suggestions`.
2. Place it in an appropriate location — near the treatment plans section or odontogram section of the patient page. Look at the existing page layout and find where treatment-related content lives.
3. Pass `patientId` from the route params.
4. If the page uses tabs, consider placing it within the treatment plan tab or as a collapsible section.
5. Do NOT disrupt existing page layout or functionality.
  </action>
  <verify>`pnpm --filter @dentflow/web build` succeeds. Navigate to patient page, AI treatment suggestion button is visible and functional.</verify>
  <done>Patient page shows AI treatment suggestion button; clicking it fetches and displays AI suggestions from odontogram data</done>
</task>

</tasks>

<verification>
- Build passes
- AI treatment suggestion button visible on patient page
- Clicking it calls /api/ai/suggest-treatment
- Suggestions display with NZa codes, priorities, reasoning
- Accept creates treatment plan items via existing API
- Clear AI labeling on all suggestions
</verification>

<success_criteria>
- AI suggests treatments based on odontogram diagnoses
- Each suggestion shows tooth, code, priority, reasoning
- Dentist can accept individual or all suggestions
- Suggestions are clearly marked as AI-generated
</success_criteria>

<output>
After completion, create `.planning/phases/05-ai-clinical-intelligence/05-03-SUMMARY.md`
</output>
