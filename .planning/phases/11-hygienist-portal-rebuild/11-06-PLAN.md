---
phase: 11-hygienist-portal-rebuild
plan: 06
type: execute
wave: 2
depends_on: [11-01]
files_modified:
  - apps/web/src/app/(hygienist)/hygienist/consent/page.tsx
  - apps/web/src/app/(hygienist)/hygienist/referrals/page.tsx
  - apps/web/src/app/(hygienist)/hygienist/documents/page.tsx
  - apps/web/src/app/(hygienist)/hygienist/settings/page.tsx
  - apps/web/src/app/(hygienist)/hygienist/dashboard/page.tsx
autonomous: true
requirements: [HYG-01]

must_haves:
  truths:
    - "Consent page manages consent form templates and tracks patient signatures"
    - "Referrals page creates and tracks referral letters"
    - "Documents page uploads and categorizes patient documents"
    - "Settings page has profile and preferences tabs"
    - "Dashboard shows hygienist-specific widgets and metrics"
  artifacts:
    - path: "apps/web/src/app/(hygienist)/hygienist/consent/page.tsx"
      provides: "Consent form management"
      min_lines: 120
    - path: "apps/web/src/app/(hygienist)/hygienist/settings/page.tsx"
      provides: "Profile + preferences settings"
      min_lines: 100
    - path: "apps/web/src/app/(hygienist)/hygienist/dashboard/page.tsx"
      provides: "Rebuilt dashboard with richer widgets"
      min_lines: 200
  key_links:
    - from: "dashboard/page.tsx"
      to: "/api/hygienist/reports"
      via: "Dashboard widgets fetch summary data"
      pattern: "api/hygienist"
---

<objective>
Build remaining portal pages (consent, referrals, documents, settings) and rebuild the dashboard with richer hygienist-specific widgets.

Purpose: Complete the full standalone portal with all 12+ pages functional.
Output: Consent, referrals, documents, settings pages + rebuilt dashboard.
</objective>

<execution_context>
@/Users/farazsharifi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/farazsharifi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-hygienist-portal-rebuild/11-RESEARCH.md
@.planning/phases/11-hygienist-portal-rebuild/11-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Consent, referrals, and documents pages</name>
  <files>
    apps/web/src/app/(hygienist)/hygienist/consent/page.tsx
    apps/web/src/app/(hygienist)/hygienist/referrals/page.tsx
    apps/web/src/app/(hygienist)/hygienist/documents/page.tsx
  </files>
  <action>
**consent/page.tsx:**
Consent form management page. Use existing consent API endpoints (`/api/consent-forms`, `/api/patient-portal/consent`).

Features:
- List consent forms: table with patient name, form type, status (PENDING/SIGNED/EXPIRED), sent date, signed date
- Create template: form with title, content (rich text area), category
- Send to patient: select patient, select template, sends consent form
- Track signatures: see which patients have signed/pending
- View signed form: expandable row with signature details
- Use authFetch for all API calls

**referrals/page.tsx:**
Referral letter management. Use existing referral endpoints (`/api/patients/[id]/referrals`).

Features:
- List referrals: table with patient name, referred to (specialist name/practice), reason, date, status
- Create referral: form with patient selector, specialist name, specialty, reason, clinical notes attachment
- Status tracking: DRAFT/SENT/ACCEPTED/COMPLETED
- View referral letter: expandable detail view

**documents/page.tsx:**
Document management. Use existing document endpoints.

Features:
- List all documents for practice: table with patient name, document name, category, upload date, uploaded by
- Upload document: file picker + patient selector + category dropdown (X-ray, Report, Consent, Other)
- Upload to Vercel Blob (same pattern as patient portal document upload)
- Download document: click to download
- Filter by: patient, category, date range
  </action>
  <verify>Run `pnpm --filter @dentflow/web build` — no errors.</verify>
  <done>Consent, referrals, and documents pages functional with CRUD operations using existing API endpoints</done>
</task>

<task type="auto">
  <name>Task 2: Settings page + dashboard rebuild</name>
  <files>
    apps/web/src/app/(hygienist)/hygienist/settings/page.tsx
    apps/web/src/app/(hygienist)/hygienist/dashboard/page.tsx
  </files>
  <action>
**settings/page.tsx:**
Two tabs:

1. **Profiel** — Edit profile form: name, email (read-only), phone, photo upload (Vercel Blob), password change (current + new + confirm). Save via PUT to `/api/users/[id]`.

2. **Voorkeuren** — Perio preferences form:
   - Default chart view: "Buccaal eerst" / "Linguaal eerst" (toggle)
   - Auto-advance speed: "Normaal" / "Snel" (skip BOP confirmation on normal teeth)
   - Default session type: FULL / PARTIAL
   - Notification preferences: email on new patient message (toggle), email on recall due (toggle)
   - Save to localStorage (preferences are client-side, per device)

No practice settings access (per decision — admin/dentist only).

**dashboard/page.tsx — Rebuild with richer widgets:**

Replace current basic dashboard. Same Tailwind styling as dentist dashboard.

Widgets (4 top cards):
1. **Vandaag** — Today's appointment count, next appointment time + patient name
2. **Recalls** — Overdue recall count (red badge if >0), due this week count
3. **Perio Risico** — High-risk patients count, patients needing re-evaluation
4. **Berichten** — Unread patient messages count, unread staff messages count

Below cards:
- **Agenda vandaag** — Compact list of today's appointments with time, patient, type
- **Recente patienten** — Last 5 patients seen with quick-link to perio page
- **Vervallen recalls** — Top 5 overdue recalls with "Herinnering sturen" action

Fetch dashboard data from existing endpoints + `/api/hygienist/reports?type=perio-overview` + `/api/hygienist/recalls?status=OVERDUE`.
  </action>
  <verify>Run `pnpm --filter @dentflow/web build` — no errors.</verify>
  <done>Settings has profile editing and perio preferences, dashboard shows rich hygienist-specific widgets with today's schedule, recalls, risk patients, and messages</done>
</task>

</tasks>

<verification>
- `pnpm --filter @dentflow/web build` succeeds
- All new pages render without errors
- Dashboard shows relevant hygienist metrics
- Settings allows profile editing and preference storage
</verification>

<success_criteria>
All 12+ portal pages are functional: dashboard, agenda, patients, perio, clinical notes, messaging, billing, reports, recalls, consent, referrals, documents, settings. No re-exported dentist pages remain.
</success_criteria>

<output>
After completion, create `.planning/phases/11-hygienist-portal-rebuild/11-06-SUMMARY.md`
</output>
