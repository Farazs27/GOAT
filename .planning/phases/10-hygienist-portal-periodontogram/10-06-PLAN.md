---
phase: 10-hygienist-portal-periodontogram
plan: 06
type: execute
wave: 3
depends_on: ["10-03", "10-04"]
files_modified:
  - apps/web/src/app/(dashboard)/dashboard/page.tsx
  - apps/web/src/app/api/dashboard/hygienist/route.ts
  - apps/web/src/app/api/patient-portal/hygienist-notes/route.ts
  - apps/web/src/app/(patient)/portal/care-notes/page.tsx
autonomous: true
requirements: [HYG-01, HYG-02, HYG-03, HYG-04, HYG-05, CLIN-06, CLIN-07]

must_haves:
  truths:
    - "Hygienist sees custom dashboard with today's appointments, pending perio charts, overdue patients, BOP trends"
    - "Dentist dashboard is unchanged"
    - "Patient portal shows simplified hygienist notes (home care instructions, next visit)"
    - "All 7 requirements verified end-to-end"
  artifacts:
    - path: "apps/web/src/app/api/dashboard/hygienist/route.ts"
      provides: "Hygienist dashboard data API"
      contains: "pendingPerioCharts"
    - path: "apps/web/src/app/(patient)/portal/care-notes/page.tsx"
      provides: "Patient-facing hygienist notes view"
      contains: "homeCareInstructions"
  key_links:
    - from: "apps/web/src/app/(dashboard)/dashboard/page.tsx"
      to: "/api/dashboard/hygienist"
      via: "conditional fetch based on user role"
      pattern: "HYGIENIST.*hygienist"
---

<objective>
Hygienist-specific dashboard widgets, patient portal hygienist notes view, and end-to-end verification of all phase requirements.

Purpose: Complete the hygienist portal experience and verify everything works together.
Output: Hygienist dashboard, patient care notes page, full verification.
</objective>

<execution_context>
@/Users/farazsharifi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/farazsharifi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-hygienist-portal-periodontogram/10-CONTEXT.md
@.planning/phases/10-hygienist-portal-periodontogram/10-RESEARCH.md
@.planning/phases/10-hygienist-portal-periodontogram/10-01-SUMMARY.md
@.planning/phases/10-hygienist-portal-periodontogram/10-03-SUMMARY.md
@.planning/phases/10-hygienist-portal-periodontogram/10-04-SUMMARY.md
@apps/web/src/app/(dashboard)/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Hygienist dashboard + API</name>
  <files>apps/web/src/app/api/dashboard/hygienist/route.ts, apps/web/src/app/(dashboard)/dashboard/page.tsx</files>
  <action>
1. **Create `/api/dashboard/hygienist/route.ts`:**
   - Returns hygienist-specific widget data:
     - `todayAppointments`: Appointments for today where practitionerId = current user, include patient name, time, type
     - `pendingPerioCharts`: Patients who had a hygiene appointment in last 7 days but have no PeriodontalChart created within 1 day of that appointment (charts that still need to be recorded)
     - `overduePatients`: Patients whose last hygiene appointment (with current hygienist) was > 6 months ago, sorted by most overdue
     - `bopTrends`: Last 5 perio charts authored by current user, each with BOP% calculated from chartData. Return `[{ date, bopPercent, patientName }]`
   - Authenticate via access_token, scope to practiceId

2. **Update `dashboard/page.tsx`:**
   - Read user role (from localStorage or decoded token)
   - If role === 'HYGIENIST': fetch from `/api/dashboard/hygienist` and render hygienist widgets instead of default dashboard
   - **Hygienist dashboard widgets (4 cards in 2x2 grid):**
     - "Vandaag" — today's appointments list (time, patient name, type)
     - "Openstaande Paro Charts" — pending perio charts (patient name, appointment date, "Start" link to perio mode)
     - "Overdue Patiënten" — patients overdue for cleaning (name, last visit date, days overdue)
     - "BOP Trends" — simple sparkline or bar chart showing recent BOP% values (use inline SVG bars, no chart library)
   - Glass card styling for all widgets
   - If role !== 'HYGIENIST': render existing dashboard unchanged (no modifications to current dashboard code path)
  </action>
  <verify>Run `pnpm --filter @dentflow/web build` — no errors. Log in as hygienist — see custom dashboard with 4 widgets. Log in as dentist — see normal dashboard unchanged.</verify>
  <done>Hygienist gets custom dashboard with relevant widgets. Dentist dashboard completely unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Patient portal hygienist notes + perio auto-sync</name>
  <files>apps/web/src/app/api/patient-portal/hygienist-notes/route.ts, apps/web/src/app/(patient)/portal/care-notes/page.tsx, apps/web/src/app/(patient)/portal/layout.tsx</files>
  <action>
1. **Create `/api/patient-portal/hygienist-notes/route.ts`:**
   - GET: Fetch HYGIENE type ClinicalNote records for authenticated patient. Return simplified view: only homeCareInstructions, nextVisitRecommendation, createdAt, authorName. Do NOT expose oralHygieneScore, BOP%, or compliance notes (these are clinical internal).

2. **Create `portal/care-notes/page.tsx`:**
   - Patient-facing page titled "Verzorgingsadvies" (Care Advice)
   - List hygienist notes as cards (most recent first): date, hygienist name, home care instructions, next visit recommendation
   - Glass card styling matching patient portal patterns
   - Empty state: "Nog geen verzorgingsadvies beschikbaar"

3. **Update `portal/layout.tsx`:**
   - Add "Verzorgingsadvies" nav item to patient portal sidebar (after Documents or at appropriate position)
   - Use `Heart` or `Stethoscope` icon from lucide-react

4. **Perio session auto-sync to clinical notes:**
   - In the perio chart save flow (wherever PeriodontalChart is created/updated via API), after saving the chart, auto-create a HYGIENE type ClinicalNote containing:
     - oralHygieneScore: 0 (placeholder, hygienist can edit later)
     - bopPercentage: calculated from chart data
     - homeCareInstructions: "" (placeholder)
     - complianceNotes: "" (placeholder)
     - nextVisitRecommendation: "" (placeholder)
     - perioChartId: the saved chart's ID (for linking)
     - sessionNote: from the chart's sessionNote field
   - This creates the perio summary card that appears in the Hygienist Notes tab (plan 04 renders these)
  </action>
  <verify>Run `pnpm --filter @dentflow/web build` — no errors. Patient portal shows "Verzorgingsadvies" in nav. Save a perio chart — HYGIENE note auto-created. Patient sees simplified care advice.</verify>
  <done>Patient portal shows simplified hygienist care notes. Perio sessions auto-sync as clinical notes. All phase requirements verified.</done>
</task>

</tasks>

<verification>
End-to-end verification of ALL phase requirements:

1. **HYG-01** (Hygienist dedicated view): Log in as hygienist@tandarts-amsterdam.nl / Welcome123 — see custom dashboard, filtered sidebar
2. **HYG-04** (No smile design): Verify Smile Design NOT in hygienist sidebar
3. **CLIN-06** (Complete periodontogram): Open perio mode, enter all measurement types (probing, recession, BOP, plaque, mobility, furcation, suppuration, MGJ, KTW), see CAL auto-calculated
4. **CLIN-07** (Fast data entry): Use voice input "tooth 16: 3 2 4 3 2 3", values populate. Use click entry for other fields.
5. **HYG-02** (Record perio data): Save perio chart with full data, verify it persists. Verify line graph visualization with color coding.
6. **HYG-03** (Shared notes): Open patient notes, see Dentist/Hygienist tabs. Create hygienist note. Add flag — notification sent to dentist. Perio summary card visible.
7. **HYG-05** (Internal communication): Open Team Chat, create conversation with dentist, send message, verify it appears.

- `pnpm --filter @dentflow/web build` passes
</verification>

<success_criteria>
Hygienist dashboard with 4 custom widgets. Patient portal care notes page. Perio session auto-syncs to clinical notes. All 7 requirements (CLIN-06, CLIN-07, HYG-01 through HYG-05) verified end-to-end.
</success_criteria>

<output>
After completion, create `.planning/phases/10-hygienist-portal-periodontogram/10-06-SUMMARY.md`
</output>
