---
phase: 11-hygienist-portal-rebuild
plan: 07
type: execute
wave: 3
depends_on: [11-02, 11-03, 11-04, 11-05, 11-06]
files_modified:
  - apps/web/src/app/api/auth/login/route.ts
autonomous: false
requirements: [HYG-01, HYG-02, HYG-03, HYG-04, HYG-05, CLIN-06, CLIN-07]

must_haves:
  truths:
    - "HYGIENIST role user redirects to /hygienist/dashboard after login"
    - "All 12+ sidebar nav items lead to working pages"
    - "Periodontogram sequential entry works end-to-end"
    - "Clinical notes shared between hygienist and dentist"
    - "No smile design or restoration editing accessible"
    - "Patient messaging and staff chat both functional"
    - "Billing/declaratie works for P-codes"
  artifacts:
    - path: "apps/web/src/app/api/auth/login/route.ts"
      provides: "Role-based routing for HYGIENIST"
      contains: "HYGIENIST"
  key_links:
    - from: "login/route.ts"
      to: "/hygienist/dashboard"
      via: "role-based redirect"
      pattern: "hygienist/dashboard"
---

<objective>
Verify role-based login routing and perform end-to-end verification of the complete hygienist portal.

Purpose: Ensure the entire portal works as a cohesive product.
Output: Verified working portal with login routing.
</objective>

<execution_context>
@/Users/farazsharifi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/farazsharifi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-hygienist-portal-rebuild/11-01-SUMMARY.md
@.planning/phases/11-hygienist-portal-rebuild/11-02-SUMMARY.md
@.planning/phases/11-hygienist-portal-rebuild/11-03-SUMMARY.md
@.planning/phases/11-hygienist-portal-rebuild/11-04-SUMMARY.md
@.planning/phases/11-hygienist-portal-rebuild/11-05-SUMMARY.md
@.planning/phases/11-hygienist-portal-rebuild/11-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify login routing + fix integration issues</name>
  <files>apps/web/src/app/api/auth/login/route.ts</files>
  <action>
Verify the login route handles HYGIENIST role routing:

1. Check `/api/auth/login` route.ts — ensure that when a user with role HYGIENIST logs in, the response includes a redirect path or the client-side login page routes to `/hygienist/dashboard`. If not already implemented (Phase 10 should have done this), add role-based routing logic.

2. Run `pnpm --filter @dentflow/web build` to catch any TypeScript/import errors across all new pages.

3. Fix any build errors found — missing imports, type mismatches, API route issues.

4. Ensure the seed data includes a HYGIENIST role user (should exist from Phase 10 seed). If not, note but do not modify seed.

5. Verify all API routes compile: `/api/hygienist/perio-sessions`, `/api/hygienist/protocols`, `/api/hygienist/recalls`, `/api/hygienist/reports`, `/api/hygienist/conversations`.
  </action>
  <verify>Run `pnpm --filter @dentflow/web build` — zero errors. All pages and API routes compile.</verify>
  <done>Build passes cleanly with all hygienist portal pages and API routes</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end portal verification</name>
  <action>Human verifies the complete hygienist portal works as a cohesive product by testing all pages, periodontogram, messaging, billing, and verifying no smile design access.</action>
  <what-built>Complete hygienist portal with 12+ pages, 2D periodontogram, messaging, billing, reports, recalls, and all clinical tools</what-built>
  <how-to-verify>
    1. Start dev server: `pnpm --filter @dentflow/web dev`
    2. Login as hygienist user at http://localhost:3000/login — should redirect to /hygienist/dashboard
    3. Verify dashboard shows widgets (appointments, recalls, risk patients, messages)
    4. Click through ALL sidebar nav items — each should load a working page
    5. Open a patient -> go to Perio tab -> open periodontogram
    6. Enter probing depths sequentially — verify auto-advance and BOP recording
    7. Verify chart updates with color-coded depth bars
    8. Check clinical notes page — should show notes from both hygienist and dentist
    9. Check messaging — patient tab and staff tab both functional
    10. Check billing — can browse P-codes and create declaratie
    11. Verify NO smile design or restoration editing accessible anywhere
  </how-to-verify>
  <verify>User confirms all pages functional</verify>
  <done>User approves complete portal</done>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- `pnpm --filter @dentflow/web build` succeeds with zero errors
- Login routing works for HYGIENIST role
- All pages accessible and functional
- Periodontogram entry + visualization working
- No smile design anywhere in portal
</verification>

<success_criteria>
Complete hygienist portal verified end-to-end: login routing, all 12+ pages functional, periodontogram charting, shared notes, messaging, billing, reports, recalls — all working as a cohesive standalone portal.
</success_criteria>

<output>
After completion, create `.planning/phases/11-hygienist-portal-rebuild/11-07-SUMMARY.md`
</output>
