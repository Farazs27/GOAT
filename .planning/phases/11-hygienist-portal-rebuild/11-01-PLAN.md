---
phase: 11-hygienist-portal-rebuild
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/database/prisma/schema.prisma
  - apps/web/src/app/(hygienist)/layout.tsx
autonomous: true
requirements: [HYG-01, HYG-04]

must_haves:
  truths:
    - "Hygienist sidebar has 12+ nav items grouped logically"
    - "Sidebar excludes smile design / odontogram restoration editing"
    - "PerioSession, PerioSite, PerioProtocol, RecallSchedule tables exist in database"
    - "Prisma client generates without errors"
    - "Build passes with new schema"
  artifacts:
    - path: "packages/database/prisma/schema.prisma"
      provides: "PerioSession, PerioSite, PerioProtocol, RecallSchedule models with all relations"
      contains: "model PerioSession"
    - path: "apps/web/src/app/(hygienist)/layout.tsx"
      provides: "Expanded sidebar with 12+ nav items"
      min_lines: 200
  key_links:
    - from: "schema.prisma PerioSession"
      to: "Patient, Practice, User, Appointment"
      via: "Prisma relations (both sides)"
      pattern: "PerioSession\\[\\]"
    - from: "schema.prisma PerioSite"
      to: "PerioSession"
      via: "Prisma relation"
      pattern: "session.*PerioSession"
---

<objective>
Add relational perio schema (PerioSession, PerioSite, PerioProtocol, RecallSchedule) replacing JSON chartData approach, and expand the hygienist sidebar nav from 5 items to 12+ items covering all portal pages.

Purpose: Foundation for all subsequent plans — schema enables perio data persistence, sidebar enables navigation to all new pages.
Output: Updated schema with new tables pushed to DB, expanded sidebar layout.
</objective>

<execution_context>
@/Users/farazsharifi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/farazsharifi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-hygienist-portal-rebuild/11-RESEARCH.md
@packages/database/prisma/schema.prisma
@apps/web/src/app/(hygienist)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add relational perio schema models</name>
  <files>packages/database/prisma/schema.prisma</files>
  <action>
Add four new models to schema.prisma following the exact schema from 11-RESEARCH.md:

1. **PerioSession** — id, practiceId, patientId, appointmentId?, authorId, sessionType (FULL/PARTIAL/RE_EVALUATION), sessionNote?, protocolId?, timestamps. Relations to Practice, Patient, Appointment?, User (author), PerioProtocol?, PerioSite[]. Map to "perio_sessions".

2. **PerioSite** — id, sessionId, toothNumber (FDI Int), surface (buccal/lingual), sitePosition (mesial/mid/distal), probingDepth (Int), gingivalMargin (Int, negative=recession), bleeding (Boolean), plaque (Boolean), suppuration (Boolean), mobility (Int?), furcationGrade (Int? 0-3), isImplant (Boolean), toothNote (String?), keratinizedWidth (Int?). Relation to PerioSession. Index on [sessionId, toothNumber]. Map to "perio_sites".

3. **PerioProtocol** — id, practiceId, patientId, status (ACTIVE/COMPLETED/CANCELLED), steps (Json — array of {name, status, sessionId?, dueDate?}), timestamps. Relations to Practice, Patient, PerioSession[]. Map to "perio_protocols".

4. **RecallSchedule** — id, practiceId, patientId, intervalMonths (Int), nextDueDate (DateTime), status (DUE/OVERDUE/COMPLETED/CANCELLED), lastCompletedAt?, reminderSentAt?, timestamps. Relations to Practice, Patient. Unique constraint on [practiceId, patientId]. Map to "recall_schedules".

**Critical:** Add inverse relation arrays on Patient, Practice, User, and Appointment models:
- Patient: `perioSessions PerioSession[]`, `perioProtocols PerioProtocol[]`, `recallSchedules RecallSchedule[]`
- Practice: `perioSessions PerioSession[]`, `perioProtocols PerioProtocol[]`, `recallSchedules RecallSchedule[]`
- User: `perioSessionsAuthored PerioSession[]` (named to avoid conflict)
- Appointment: `perioSessions PerioSession[]`

After adding models, run: `pnpm db:generate && pnpm db:push`

Do NOT delete or modify the existing PeriodontalChart model — keep it for backward compatibility.
  </action>
  <verify>Run `pnpm db:generate` (no errors) and `pnpm --filter @dentflow/web build` (compiles)</verify>
  <done>Four new tables exist in database, Prisma client generates cleanly, build passes</done>
</task>

<task type="auto">
  <name>Task 2: Expand hygienist sidebar navigation</name>
  <files>apps/web/src/app/(hygienist)/layout.tsx</files>
  <action>
Rebuild the sidebar nav in layout.tsx from 5 items to 12+ items. Keep the existing glass-style layout structure and emerald accent color. Group nav items logically:

**Nav items (in order):**
1. Dashboard — LayoutDashboard icon — `/hygienist/dashboard`
2. Agenda — Calendar icon — `/hygienist/agenda`
3. Patienten — Users icon — `/hygienist/patients`
4. Periodontogram — Activity icon — `/hygienist/patients` (section header or link to perio from patient)
5. Klinische Notities — FileText icon — `/hygienist/notes`
6. Berichten — MessageSquare icon — `/hygienist/berichten` — with unread badge support
7. Declaratie — Receipt icon — `/hygienist/billing`
8. Rapporten — BarChart3 icon — `/hygienist/reports`
9. Recall — Bell icon — `/hygienist/recalls`
10. Toestemming — ClipboardCheck icon — `/hygienist/consent`
11. Verwijzingen — Send icon — `/hygienist/referrals`
12. Documenten — FolderOpen icon — `/hygienist/documents`
13. Instellingen — Settings icon — `/hygienist/settings`

**Do NOT include:** Smile design, odontogram restoration editing, practice settings, admin tools.

Keep the existing client component pattern for nav items (Phase 10 decision: icons in client component to avoid React serialization). Keep the sidebar scrollable (`overflow-y-auto`) for smaller screens. Add visual section dividers between groups (Clinical: items 1-5, Communication: 6, Admin: 7-9, Management: 10-13) using subtle `border-t border-white/10` dividers.

Maintain identical Tailwind styling as dentist dashboard sidebar (same widths, padding, hover states) per locked decision.
  </action>
  <verify>Run `pnpm --filter @dentflow/web build` — no errors. Visually: sidebar should show all 13 items.</verify>
  <done>Sidebar has 13 nav items with logical grouping, no smile design, scrollable, matches dentist styling</done>
</task>

</tasks>

<verification>
- `pnpm db:generate` succeeds
- `pnpm --filter @dentflow/web build` succeeds
- Schema has PerioSession, PerioSite, PerioProtocol, RecallSchedule with all relations
- Sidebar has 12+ nav items, no smile design section
</verification>

<success_criteria>
Database has four new tables. Hygienist sidebar navigation covers all 12+ portal sections. Build passes cleanly.
</success_criteria>

<output>
After completion, create `.planning/phases/11-hygienist-portal-rebuild/11-01-SUMMARY.md`
</output>
