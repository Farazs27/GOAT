---
phase: 06-agenda-scheduling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/(dashboard)/agenda/page.tsx
  - apps/web/src/components/agenda/multi-practitioner-grid.tsx
  - apps/web/src/components/agenda/appointment-block.tsx
  - apps/web/src/components/agenda/time-grid.tsx
autonomous: true
requirements: [AGND-03]

must_haves:
  truths:
    - "Staff can see a column for each practitioner in the day view"
    - "Appointments appear in the correct practitioner column"
    - "Staff can switch between single-practitioner and multi-practitioner views"
  artifacts:
    - path: "apps/web/src/components/agenda/multi-practitioner-grid.tsx"
      provides: "Multi-practitioner column layout for day view"
      min_lines: 80
    - path: "apps/web/src/components/agenda/appointment-block.tsx"
      provides: "Extracted appointment block component"
      min_lines: 30
    - path: "apps/web/src/components/agenda/time-grid.tsx"
      provides: "Extracted time grid component"
      min_lines: 50
  key_links:
    - from: "apps/web/src/components/agenda/multi-practitioner-grid.tsx"
      to: "/api/appointments"
      via: "appointments filtered by practitionerId per column"
      pattern: "practitionerId"
    - from: "apps/web/src/app/(dashboard)/agenda/page.tsx"
      to: "apps/web/src/components/agenda/multi-practitioner-grid.tsx"
      via: "import and render in day view"
      pattern: "MultiPractitionerGrid"
---

<objective>
Extract agenda components and add multi-practitioner side-by-side column view in the day view.

Purpose: The agenda page is 2,652 lines. Extract reusable components (appointment block, time grid) to manage complexity, then build a multi-practitioner column layout so staff can see all practitioners' schedules simultaneously.

Output: Extracted components + multi-practitioner day view with one column per practitioner.
</objective>

<execution_context>
@/Users/farazsharifi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/farazsharifi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/src/app/(dashboard)/agenda/page.tsx
@apps/web/src/app/api/appointments/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract appointment block and time grid components from agenda page</name>
  <files>
    apps/web/src/components/agenda/appointment-block.tsx
    apps/web/src/components/agenda/time-grid.tsx
    apps/web/src/app/(dashboard)/agenda/page.tsx
  </files>
  <action>
    Read the agenda page.tsx carefully to understand the current appointment rendering and time grid structure.

    1. Create `appointment-block.tsx`: Extract the appointment rendering logic (the colored block that shows patient name, type, time, status) into a standalone component. Props: `appointment`, `onClick`, `style` (for positioning), `className`. Keep all existing styling (type colors, status badges, time labels). Use static Tailwind class maps for appointment type colors (NEVER dynamic interpolation).

    2. Create `time-grid.tsx`: Extract the time slot grid rendering (08:00-19:00 hourly rows with half-hour lines) into a standalone component. Props: `startHour` (default 8), `endHour` (default 19), `slotHeight`, `children` (for overlaying appointments), `onSlotClick` (for creating new appointments). The grid should render hour labels and horizontal divider lines.

    3. Update `agenda/page.tsx`: Replace inline appointment block rendering with `<AppointmentBlock>` component. Replace inline time grid with `<TimeGrid>`. Verify all existing functionality (click to open detail, appointment creation, type/status display) still works with extracted components.

    Keep ALL existing behavior intact. This is a pure refactor — no new features in this task. Specifically verify that cancel/delete appointment action still works after extraction — the delete handler and its UI trigger must be preserved in the refactored code.
  </action>
  <verify>
    Run `pnpm --filter @dentflow/web build` — must succeed with no type errors.
    Visually: agenda page day view and week view render identically to before.
    Confirm cancel/delete appointment action still functions (the delete handler and confirmation dialog must still be wired up after component extraction).
  </verify>
  <done>
    Appointment blocks and time grid are extracted into reusable components. Agenda page uses them. All existing functionality preserved.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build multi-practitioner side-by-side column view in day view</name>
  <files>
    apps/web/src/components/agenda/multi-practitioner-grid.tsx
    apps/web/src/app/(dashboard)/agenda/page.tsx
  </files>
  <action>
    1. Create `multi-practitioner-grid.tsx`:
       - Fetch practitioners for the practice (use existing users/practitioners endpoint or pass as prop from agenda page which already fetches them).
       - Render one column per practitioner, each column containing a `<TimeGrid>` with appointments filtered by `practitionerId`.
       - Column header: practitioner name + role badge.
       - Layout: horizontal scroll if >3 practitioners, each column min-width ~200px.
       - Use the extracted `<AppointmentBlock>` for each appointment.
       - Pass through `onAppointmentClick` to open the existing detail panel.
       - Style: match the existing dark agenda theme. Column dividers with subtle borders.

    2. Update `agenda/page.tsx`:
       - Add a view toggle button near existing day/week toggle: "Enkel" (single) / "Team" (team) for single vs multi-practitioner mode.
       - When "Team" is selected in day view, render `<MultiPractitionerGrid>` instead of the single-practitioner time grid.
       - Week view remains unchanged (single practitioner only).
       - Default to "Enkel" view. Persist selection in component state (no localStorage needed).
       - The existing practitioner filter dropdown should still work — in Team view it shows all practitioners, in Enkel view it filters to one.

    Appointments are already fetched with practitionerId. The existing GET /api/appointments endpoint supports `practitionerId` filter param — for Team view, fetch all appointments for the date (no practitioner filter).
  </action>
  <verify>
    Run `pnpm --filter @dentflow/web build` — must succeed.
    Day view: "Team" toggle shows columns for each practitioner with their appointments. "Enkel" shows original single view.
  </verify>
  <done>
    Staff can toggle between single and multi-practitioner day views. Each practitioner has their own column with correctly filtered appointments.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @dentflow/web build` passes
2. Day view renders appointment blocks using extracted components
3. "Team" toggle shows multi-practitioner columns
4. "Enkel" toggle shows original single-practitioner view
5. Week view unaffected
6. Clicking appointment in any view opens detail panel
</verification>

<success_criteria>
- Appointment blocks and time grid extracted into reusable components
- Multi-practitioner column view works in day view with toggle
- All existing agenda functionality preserved
- Build passes with no type errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-agenda-scheduling/06-01-SUMMARY.md`
</output>
