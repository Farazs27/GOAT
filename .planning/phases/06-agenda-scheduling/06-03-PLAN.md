---
phase: 06-agenda-scheduling
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/(dashboard)/agenda/schedule-manager.tsx
  - apps/web/src/app/(dashboard)/agenda/page.tsx
autonomous: true
requirements: [AGND-02]

must_haves:
  truths:
    - "Staff can view existing recurring schedule slots per practitioner"
    - "Staff can create new recurring schedule slots (day, start/end time, slot duration)"
    - "Staff can edit and delete recurring schedule slots"
  artifacts:
    - path: "apps/web/src/app/(dashboard)/agenda/schedule-manager.tsx"
      provides: "Recurring slot management UI"
      min_lines: 100
  key_links:
    - from: "apps/web/src/app/(dashboard)/agenda/schedule-manager.tsx"
      to: "/api/schedules"
      via: "GET to list, POST to create, PATCH/DELETE to manage"
      pattern: "api/schedules"
---

<objective>
Build a recurring schedule slot management UI for practitioners.

Purpose: Staff need to define weekly availability patterns (e.g., Dr. Sharifi works Monday 08:00-17:00, 15-minute slots). The PractitionerSchedule model and API already exist — this adds the UI.

Output: Schedule manager component accessible from the agenda page.
</objective>

<execution_context>
@/Users/farazsharifi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/farazsharifi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/src/app/api/schedules/route.ts
@apps/web/src/app/api/schedules/[id]/route.ts
@packages/database/prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build recurring schedule slot management UI</name>
  <files>
    apps/web/src/app/(dashboard)/agenda/schedule-manager.tsx
    apps/web/src/app/(dashboard)/agenda/page.tsx
  </files>
  <action>
    1. Create `schedule-manager.tsx` — a slide-out panel or modal accessible from the agenda page:
       - **Practitioner selector**: Dropdown of all practitioners (fetch from users endpoint or pass as prop).
       - **Schedule list**: For the selected practitioner, fetch `GET /api/schedules?practitionerId={id}` and display existing schedule slots grouped by day of week (Maandag, Dinsdag, etc.).
       - Each slot shows: day, start time, end time, slot duration, active/inactive status.
       - **Add slot form**: Select day of week (0-6 mapped to Dutch day names), start time (HH:mm input), end time (HH:mm input), slot duration (15/20/30/45/60 minute select). POST to `/api/schedules` with `{ practitionerId, dayOfWeek, startTime, endTime, slotDuration }`.
       - **Edit**: Click existing slot to edit (inline or modal). PATCH `/api/schedules/{id}`.
       - **Delete**: Delete button with confirmation. DELETE `/api/schedules/{id}`.
       - **Toggle active**: Quick toggle for `isActive` via PATCH.
       - Style: Match the dark agenda theme. Use shadcn/ui components (Button, Select, Input, Dialog).
       - Dutch labels: "Roosters beheren", "Dag", "Begintijd", "Eindtijd", "Slotduur", "Actief".

    2. Update `agenda/page.tsx`:
       - Add a "Roosters" (Schedules) button in the agenda toolbar/header area (near the view toggles).
       - Clicking opens the `ScheduleManager` as a slide-out panel from the right (similar to the existing appointment detail panel pattern).
       - Use `authFetch` for all API calls.

    The API endpoints already exist and support all CRUD operations. This is pure UI work.
  </action>
  <verify>
    Run `pnpm --filter @dentflow/web build` — must succeed.
    Click "Roosters" button → panel opens showing existing schedules.
    Add a new schedule slot → appears in list.
    Edit/delete slot → updates correctly.
  </verify>
  <done>
    Staff can manage recurring schedule slots per practitioner via the agenda page. CRUD operations work through existing API. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @dentflow/web build` passes
2. "Roosters" button visible in agenda toolbar
3. Schedule manager shows existing slots grouped by day
4. Can create new recurring slots
5. Can edit and delete existing slots
6. Can toggle active/inactive
</verification>

<success_criteria>
- Schedule manager component renders with practitioner selection
- CRUD for recurring slots works via existing /api/schedules endpoints
- Dutch labels throughout
- Matches existing dark theme
</success_criteria>

<output>
After completion, create `.planning/phases/06-agenda-scheduling/06-03-SUMMARY.md`
</output>
