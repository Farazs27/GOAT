---
phase: 05-ai-clinical-intelligence
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - apps/web/src/components/clinical/soap-note-form.tsx
autonomous: true
requirements: [AI-04]

must_haves:
  truths:
    - "Dentist can type shorthand in SOAP form and click a button to expand via AI"
    - "AI-expanded text appears as a suggestion that can be accepted, edited, or dismissed"
    - "AI-generated content is clearly labeled with an AI badge"
    - "Original shorthand is preserved and visible for comparison"
  artifacts:
    - path: "apps/web/src/components/clinical/soap-note-form.tsx"
      provides: "SOAP note form with AI shorthand expansion"
      contains: "ai/expand-notes"
  key_links:
    - from: "apps/web/src/components/clinical/soap-note-form.tsx"
      to: "/api/ai/expand-notes"
      via: "fetch call on button click"
      pattern: "fetch.*api/ai/expand-notes"
---

<objective>
Add AI shorthand expansion to the clinical SOAP note form so dentists can type abbreviations and get properly formatted clinical documentation.

Purpose: AI-04 requirement - dentist types shorthand, AI expands to proper documentation.
Output: Updated SOAP note form with AI expand button and suggestion UI.
</objective>

<execution_context>
@/Users/farazsharifi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/farazsharifi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ai-clinical-intelligence/05-01-SUMMARY.md
@apps/web/src/components/clinical/soap-note-form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AI expand button and suggestion UI to SOAP note form</name>
  <files>apps/web/src/components/clinical/soap-note-form.tsx</files>
  <action>
Modify the existing SoapNoteForm component to add AI shorthand expansion:

1. Add a "Shorthand modus" toggle/tab at the top of the form. When active, show a single large textarea for shorthand input instead of the 4 SOAP fields.

2. Add an "AI Uitbreiden" button (with a Sparkles icon from lucide-react) next to the shorthand textarea. On click:
   - Call `POST /api/ai/expand-notes` with `{ shorthand: text, format: 'soap' }`.
   - Show loading spinner during the call.
   - On success, display the AI result in a suggestion panel below the textarea.

3. AI suggestion panel:
   - Show a labeled badge: "AI-suggestie" with a distinct background (e.g., blue-50 border-blue-200 or amber tones matching the app).
   - Display the expanded SOAP fields (subjective, objective, assessment, plan) read-only.
   - Show the original shorthand in a collapsed/dimmed section for comparison.
   - Three action buttons: "Overnemen" (accept - fills the 4 SOAP fields and switches to normal mode), "Bewerken" (fills fields for editing), "Afwijzen" (dismiss suggestion).

4. When "Overnemen" or "Bewerken" is clicked:
   - Populate subjective/objective/analysis/plan state from the AI response.
   - Switch back to normal SOAP form view.
   - For "Overnemen", the form is ready to submit. For "Bewerken", user can edit first.

5. The existing form submission logic stays unchanged - it still posts to `/api/clinical-notes` with noteType SOAP.

Keep all existing functionality intact (notes list, form toggle, submit).
  </action>
  <verify>
`pnpm --filter @dentflow/web build` succeeds. Visually verify: open patient page, go to clinical notes, toggle shorthand mode, type abbreviations, click AI expand, see suggestion panel with accept/edit/dismiss.
  </verify>
  <done>SOAP note form has AI shorthand expansion: dentist types shorthand, clicks expand, sees AI suggestion with accept/edit/dismiss, accepted text fills SOAP fields for submission</done>
</task>

</tasks>

<verification>
- Build passes
- Shorthand mode toggle works
- AI expand calls /api/ai/expand-notes
- Suggestion panel shows with clear AI labeling
- Accept fills SOAP fields, dismiss clears suggestion
</verification>

<success_criteria>
- Dentist can type shorthand and expand via AI into proper SOAP documentation
- AI suggestion is clearly marked and never auto-applied
- Original shorthand visible for comparison
</success_criteria>

<output>
After completion, create `.planning/phases/05-ai-clinical-intelligence/05-02-SUMMARY.md`
</output>
